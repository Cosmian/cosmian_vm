---
- name: Update and upgrade apt packages
  when: ansible_distribution == 'Ubuntu'
  ansible.builtin.apt:
    update_cache: true
    only_upgrade: true
    upgrade: safe
  tags: ubuntu

- name: Upgrade all packages
  when: ansible_distribution == 'RedHat'
  block:
    - name: Install required packages
      ansible.builtin.dnf:
        name:
          - python-firewall
          - firewalld
          - policycoreutils-python-utils
        state: present
        update_cache: true

- name: Update all packages
  ansible.builtin.dnf:
    name: "*"
    state: latest
    update_only: true
    update_cache: true
  tags: redhat

- name: Update security packages
  ansible.builtin.dnf:
    security: true
    state: latest
    update_only: true

- name: Ensure SELinux policies are up-to-date
  ansible.builtin.dnf:
    name: selinux-policy
    state: latest
    update_only: true
